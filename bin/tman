#!/bin/sh
## tman ::

## control ::
cmd='man man'
remote=
script="$(basename "$0")"
session="${cmd%% *}"
settings='set status off; set pane-border-status off'
socket="$session"

## main ::
set -e

# ssh into remote and run script there:
if [ -n "$remote" ] && [ "$remote" != 'localhost' ] &&
[ "$remote" != '127.0.0.1' ] && [ "$(hostname)" != "$remote" ]; then
    exec ssh -t "$remote" "bash -li -c $script"
fi

# attach tmux session:
if tmux -L "$socket" has-session -t "$session" >/dev/null 2>&1; then
    exec tmux -L "$session" attach-session -t "$session"

# create and attach tmux session:
else
    tmux -L "$socket" new-session -d -s "$session" "$cmd"
    tmux -L "$socket" select-pane -T "$session"
    [ -n "$settings" ] && tmux -L "$socket" $settings
    exec tmux -L "$socket" attach-session -t "$session"
fi

# vim:ft=sh
